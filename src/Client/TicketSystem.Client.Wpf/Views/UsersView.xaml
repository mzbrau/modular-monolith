<UserControl x:Class="TicketSystem.Client.Wpf.Views.UsersView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
             xmlns:converters="clr-namespace:TicketSystem.Client.Wpf.Converters"
             mc:Ignorable="d" 
             d:DesignHeight="600" d:DesignWidth="1000">
    
    <UserControl.Resources>
        <converters:BoolToVisibilityConverter x:Key="BoolToVisibilityConverter"/>
        <converters:DateTimeToStringConverter x:Key="DateTimeToStringConverter"/>
        <converters:NotNullToBoolConverter x:Key="NotNullToBoolConverter"/>
        <converters:NotNullToVisibilityConverter x:Key="NotNullToVisibilityConverter"/>
        <converters:NullToVisibilityConverter x:Key="NullToVisibilityConverter"/>
    </UserControl.Resources>
    
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>
        
        <!-- Filter Controls -->
        <Border Grid.Row="0" Background="#F5F5F5" Padding="10" BorderBrush="#CCCCCC" BorderThickness="0,0,0,1">
            <StackPanel Orientation="Horizontal">
                <CheckBox Content="Show Active Only" IsChecked="{Binding ShowActiveOnly, Mode=TwoWay}" 
                          Margin="0,0,20,0" VerticalAlignment="Center"/>
                <CheckBox Content="Show Inactive Only" IsChecked="{Binding ShowInactiveOnly, Mode=TwoWay}" 
                          Margin="0,0,20,0" VerticalAlignment="Center"/>
                <Button Content="Apply Filter" Command="{Binding ApplyFilterCommand}" 
                        Padding="10,5" Margin="0,0,10,0"/>
                <Button Content="Clear Filter" Command="{Binding ClearFilterCommand}" 
                        Padding="10,5"/>
            </StackPanel>
        </Border>
        
        <!-- Main Content Area -->
        <Grid Grid.Row="1">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="2*"/>
                <ColumnDefinition Width="5"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>
            
            <!-- User List -->
            <DataGrid x:Name="UsersDataGrid" Grid.Column="0" 
                      ItemsSource="{Binding Users}" 
                      SelectedItem="{Binding SelectedUser, Mode=TwoWay}"
                      AutoGenerateColumns="False"
                      IsReadOnly="True"
                      SelectionMode="Single"
                      CanUserAddRows="False"
                      CanUserDeleteRows="False"
                      GridLinesVisibility="Horizontal"
                      HeadersVisibility="Column"
                      AlternatingRowBackground="#F9F9F9">
                <DataGrid.Columns>
                    <DataGridTextColumn Header="Email" Binding="{Binding Email}" Width="*" MinWidth="150"/>
                    <DataGridTextColumn Header="First Name" Binding="{Binding FirstName}" Width="120"/>
                    <DataGridTextColumn Header="Last Name" Binding="{Binding LastName}" Width="120"/>
                    <DataGridTextColumn Header="Display Name" Binding="{Binding DisplayName}" Width="150"/>
                    <DataGridCheckBoxColumn Header="Active" Binding="{Binding IsActive}" Width="80"/>
                </DataGrid.Columns>
            </DataGrid>
            
            <GridSplitter Grid.Column="1" Width="5" HorizontalAlignment="Stretch" Background="#CCCCCC"/>
            
            <!-- User Detail/Form Panel -->
            <Border Grid.Column="2" BorderBrush="#CCCCCC" BorderThickness="1,0,0,0" Padding="10">
                <ScrollViewer VerticalScrollBarVisibility="Auto">
                    <StackPanel>
                        <TextBlock Text="User Form" FontSize="16" FontWeight="Bold" Margin="0,0,0,10"/>
                        
                        <!-- Input Form -->
                        <TextBlock Text="Email:" FontWeight="Bold" Margin="0,5,0,2"/>
                        <TextBox Text="{Binding Email, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" 
                                 Margin="0,0,0,10"/>
                        
                        <TextBlock Text="First Name:" FontWeight="Bold" Margin="0,5,0,2"/>
                        <TextBox Text="{Binding FirstName, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" 
                                 Margin="0,0,0,10"/>
                        
                        <TextBlock Text="Last Name:" FontWeight="Bold" Margin="0,5,0,2"/>
                        <TextBox Text="{Binding LastName, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" 
                                 Margin="0,0,0,10"/>
                        
                        <Separator Margin="0,10"/>
                        
                        <!-- Selected User Details (Read-only) -->
                        <StackPanel Visibility="{Binding SelectedUser, Converter={StaticResource NotNullToVisibilityConverter}}">
                            <TextBlock Text="Selected User Details" FontSize="14" FontWeight="Bold" Margin="0,10,0,5"/>
                            
                            <TextBlock Text="ID:" FontWeight="Bold" Margin="0,5,0,2"/>
                            <TextBlock Text="{Binding SelectedUser.Id}" TextWrapping="Wrap" Margin="0,0,0,5"/>
                            
                            <TextBlock Text="Display Name:" FontWeight="Bold" Margin="0,5,0,2"/>
                            <TextBlock Text="{Binding SelectedUser.DisplayName}" TextWrapping="Wrap" Margin="0,0,0,5"/>
                            
                            <TextBlock Text="Active:" FontWeight="Bold" Margin="0,5,0,2"/>
                            <TextBlock Text="{Binding SelectedUser.IsActive}" Margin="0,0,0,5"/>
                            
                            <TextBlock Text="Created:" FontWeight="Bold" Margin="0,5,0,2"/>
                            <TextBlock Text="{Binding SelectedUser.CreatedDate, Converter={StaticResource DateTimeToStringConverter}}" Margin="0,0,0,5"/>
                        </StackPanel>
                    </StackPanel>
                </ScrollViewer>
            </Border>
        </Grid>
        
        <!-- Action Buttons -->
        <Border Grid.Row="2" Background="#F5F5F5" Padding="10" BorderBrush="#CCCCCC" BorderThickness="0,1,0,0">
            <StackPanel Orientation="Horizontal">
                <Button Content="Load Users" Command="{Binding LoadUsersCommand}" 
                        Padding="10,5" Margin="0,0,10,0"/>
                <Button Content="Create User" Command="{Binding CreateUserCommand}" 
                        Padding="10,5" Margin="0,0,10,0"/>
                <Button Content="Edit User" Command="{Binding EditUserCommand}" 
                        IsEnabled="{Binding SelectedUser, Converter={StaticResource NotNullToBoolConverter}}"
                        Padding="10,5" Margin="0,0,10,0"/>
                <Button Content="Deactivate User" Command="{Binding DeactivateUserCommand}" 
                        IsEnabled="{Binding SelectedUser, Converter={StaticResource NotNullToBoolConverter}}"
                        Padding="10,5"/>
            </StackPanel>
        </Border>
        
        <!-- Loading Indicator Overlay -->
        <Grid Grid.RowSpan="3" 
              Visibility="{Binding IsLoading, Converter={StaticResource BoolToVisibilityConverter}}"
              Background="#80000000">
            <StackPanel HorizontalAlignment="Center" VerticalAlignment="Center">
                <ProgressBar IsIndeterminate="True" Width="200" Height="20"/>
                <TextBlock Text="Loading..." Foreground="White" Margin="0,10,0,0" FontSize="14"/>
            </StackPanel>
        </Grid>
        
        <!-- Error Message Display -->
        <Border Grid.RowSpan="3" 
                Visibility="{Binding ErrorMessage, Converter={StaticResource NotNullToVisibilityConverter}}"
                Background="#FFEEEE" 
                BorderBrush="#FF0000" 
                BorderThickness="2"
                Padding="10"
                Margin="20"
                VerticalAlignment="Top">
            <StackPanel>
                <TextBlock Text="Error" FontWeight="Bold" Foreground="#CC0000" Margin="0,0,0,5"/>
                <TextBlock Text="{Binding ErrorMessage}" TextWrapping="Wrap" Foreground="#CC0000"/>
                <Button Content="Dismiss" Command="{Binding DismissErrorCommand}" 
                        HorizontalAlignment="Right" Margin="0,10,0,0" Padding="10,5"/>
            </StackPanel>
        </Border>
    </Grid>
</UserControl>
