<UserControl x:Class="TicketSystem.Client.Wpf.Views.IssuesView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
             xmlns:converters="clr-namespace:TicketSystem.Client.Wpf.Converters"
             mc:Ignorable="d" 
             d:DesignHeight="600" d:DesignWidth="1000">
    
    <UserControl.Resources>
        <converters:StatusToStringConverter x:Key="StatusToStringConverter"/>
        <converters:BoolToVisibilityConverter x:Key="BoolToVisibilityConverter"/>
        <converters:DateTimeToStringConverter x:Key="DateTimeToStringConverter"/>
        <converters:NotNullToBoolConverter x:Key="NotNullToBoolConverter"/>
        <converters:NotNullToVisibilityConverter x:Key="NotNullToVisibilityConverter"/>
        <converters:NullToVisibilityConverter x:Key="NullToVisibilityConverter"/>
    </UserControl.Resources>
    
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>
        
        <!-- Filter Controls -->
        <Border Grid.Row="0" Background="#F5F5F5" Padding="10" BorderBrush="#CCCCCC" BorderThickness="0,0,0,1">
            <StackPanel Orientation="Horizontal">
                <TextBlock Text="Filter by Status:" VerticalAlignment="Center" Margin="0,0,10,0"/>
                <ComboBox x:Name="StatusFilterComboBox" Width="150" Margin="0,0,20,0"
                          SelectedValue="{Binding FilterStatus, Mode=TwoWay}">
                    <ComboBoxItem Content="All" IsSelected="True"/>
                    <ComboBoxItem Content="Open" Tag="0"/>
                    <ComboBoxItem Content="In Progress" Tag="1"/>
                    <ComboBoxItem Content="Blocked" Tag="2"/>
                    <ComboBoxItem Content="Resolved" Tag="3"/>
                    <ComboBoxItem Content="Closed" Tag="4"/>
                </ComboBox>
                
                <TextBlock Text="Filter by Assignee:" VerticalAlignment="Center" Margin="0,0,10,0"/>
                <TextBox x:Name="AssigneeFilterTextBox" Width="200" Margin="0,0,20,0"
                         Text="{Binding FilterAssignee, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"/>
                
                <Button Content="Apply Filter" Command="{Binding ApplyFilterCommand}" 
                        Padding="10,5" Margin="0,0,10,0"/>
                <Button Content="Clear Filter" Command="{Binding ClearFilterCommand}" 
                        Padding="10,5"/>
            </StackPanel>
        </Border>
        
        <!-- Main Content Area -->
        <Grid Grid.Row="1">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="2*"/>
                <ColumnDefinition Width="5"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>
            
            <!-- Issue List -->
            <DataGrid x:Name="IssuesDataGrid" Grid.Column="0" 
                      ItemsSource="{Binding Issues}" 
                      SelectedItem="{Binding SelectedIssue, Mode=TwoWay}"
                      AutoGenerateColumns="False"
                      IsReadOnly="True"
                      SelectionMode="Single"
                      CanUserAddRows="False"
                      CanUserDeleteRows="False"
                      GridLinesVisibility="Horizontal"
                      HeadersVisibility="Column"
                      AlternatingRowBackground="#F9F9F9">
                <DataGrid.Columns>
                    <DataGridTextColumn Header="Title" Binding="{Binding Title}" Width="*" MinWidth="150"/>
                    <DataGridTextColumn Header="Status" 
                                        Binding="{Binding Status, Converter={StaticResource StatusToStringConverter}}" 
                                        Width="120"/>
                    <DataGridTextColumn Header="Priority" Binding="{Binding Priority}" Width="80"/>
                    <DataGridTextColumn Header="Assigned User" Binding="{Binding AssignedUserId}" Width="120"/>
                    <DataGridTextColumn Header="Assigned Team" Binding="{Binding AssignedTeamId}" Width="120"/>
                    <DataGridTextColumn Header="Due Date" 
                                        Binding="{Binding DueDate, Converter={StaticResource DateTimeToStringConverter}, ConverterParameter='d'}" 
                                        Width="100"/>
                </DataGrid.Columns>
            </DataGrid>
            
            <GridSplitter Grid.Column="1" Width="5" HorizontalAlignment="Stretch" Background="#CCCCCC"/>
            
            <!-- Issue Detail/Form Panel -->
            <Border Grid.Column="2" BorderBrush="#CCCCCC" BorderThickness="1,0,0,0" Padding="10">
                <ScrollViewer VerticalScrollBarVisibility="Auto">
                    <StackPanel>
                        <TextBlock Text="Issue Form" FontSize="16" FontWeight="Bold" Margin="0,0,0,10"/>
                        
                        <!-- Input Form -->
                        <TextBlock Text="Title:" FontWeight="Bold" Margin="0,5,0,2"/>
                        <TextBox Text="{Binding Title, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" 
                                 Margin="0,0,0,10"/>
                        
                        <TextBlock Text="Description:" FontWeight="Bold" Margin="0,5,0,2"/>
                        <TextBox Text="{Binding Description, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" 
                                 TextWrapping="Wrap" 
                                 AcceptsReturn="True"
                                 MinHeight="60"
                                 Margin="0,0,0,10"/>
                        
                        <TextBlock Text="Priority:" FontWeight="Bold" Margin="0,5,0,2"/>
                        <TextBox Text="{Binding Priority, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" 
                                 Margin="0,0,0,10"/>
                        
                        <TextBlock Text="Due Date (optional):" FontWeight="Bold" Margin="0,5,0,2"/>
                        <DatePicker SelectedDate="{Binding DueDate, Mode=TwoWay}" 
                                    Margin="0,0,0,10"/>
                        
                        <Separator Margin="0,10"/>
                        
                        <!-- Status Update Section -->
                        <TextBlock Text="Status:" FontWeight="Bold" Margin="0,10,0,2"/>
                        <ComboBox SelectedValue="{Binding SelectedStatus, Mode=TwoWay}" 
                                  Margin="0,0,0,10">
                            <ComboBoxItem Content="Open" Tag="0"/>
                            <ComboBoxItem Content="In Progress" Tag="1"/>
                            <ComboBoxItem Content="Blocked" Tag="2"/>
                            <ComboBoxItem Content="Resolved" Tag="3"/>
                            <ComboBoxItem Content="Closed" Tag="4"/>
                        </ComboBox>
                        
                        <!-- Assignment Section -->
                        <TextBlock Text="Assign to User ID:" FontWeight="Bold" Margin="0,10,0,2"/>
                        <TextBox Text="{Binding SelectedUserId, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" 
                                 Margin="0,0,0,10"/>
                        
                        <TextBlock Text="Assign to Team ID:" FontWeight="Bold" Margin="0,10,0,2"/>
                        <TextBox Text="{Binding SelectedTeamId, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" 
                                 Margin="0,0,0,10"/>
                        
                        <Separator Margin="0,10"/>
                        
                        <!-- Selected Issue Details (Read-only) -->
                        <StackPanel Visibility="{Binding SelectedIssue, Converter={StaticResource NotNullToVisibilityConverter}}">
                            <TextBlock Text="Selected Issue Details" FontSize="14" FontWeight="Bold" Margin="0,10,0,5"/>
                            
                            <TextBlock Text="ID:" FontWeight="Bold" Margin="0,5,0,2"/>
                            <TextBlock Text="{Binding SelectedIssue.Id}" TextWrapping="Wrap" Margin="0,0,0,5"/>
                            
                            <TextBlock Text="Created:" FontWeight="Bold" Margin="0,5,0,2"/>
                            <TextBlock Text="{Binding SelectedIssue.CreatedDate, Converter={StaticResource DateTimeToStringConverter}}" Margin="0,0,0,5"/>
                            
                            <TextBlock Text="Last Modified:" FontWeight="Bold" Margin="0,5,0,2"/>
                            <TextBlock Text="{Binding SelectedIssue.LastModifiedDate, Converter={StaticResource DateTimeToStringConverter}}" Margin="0,0,0,5"/>
                        </StackPanel>
                    </StackPanel>
                </ScrollViewer>
            </Border>
        </Grid>
        
        <!-- Action Buttons -->
        <Border Grid.Row="2" Background="#F5F5F5" Padding="10" BorderBrush="#CCCCCC" BorderThickness="0,1,0,0">
            <StackPanel Orientation="Horizontal">
                <Button Content="Load Issues" Command="{Binding LoadIssuesCommand}" 
                        Padding="10,5" Margin="0,0,10,0"/>
                <Button Content="Create Issue" Command="{Binding CreateIssueCommand}" 
                        Padding="10,5" Margin="0,0,10,0"/>
                <Button Content="Edit Issue" Command="{Binding EditIssueCommand}" 
                        IsEnabled="{Binding SelectedIssue, Converter={StaticResource NotNullToBoolConverter}}"
                        Padding="10,5" Margin="0,0,10,0"/>
                <Button Content="Delete Issue" Command="{Binding DeleteIssueCommand}" 
                        IsEnabled="{Binding SelectedIssue, Converter={StaticResource NotNullToBoolConverter}}"
                        Padding="10,5" Margin="0,0,10,0"/>
                <Button Content="Update Status" Command="{Binding UpdateStatusCommand}" 
                        IsEnabled="{Binding SelectedIssue, Converter={StaticResource NotNullToBoolConverter}}"
                        Padding="10,5" Margin="0,0,10,0"/>
                <Button Content="Assign to User" Command="{Binding AssignToUserCommand}" 
                        IsEnabled="{Binding SelectedIssue, Converter={StaticResource NotNullToBoolConverter}}"
                        Padding="10,5" Margin="0,0,10,0"/>
                <Button Content="Assign to Team" Command="{Binding AssignToTeamCommand}" 
                        IsEnabled="{Binding SelectedIssue, Converter={StaticResource NotNullToBoolConverter}}"
                        Padding="10,5"/>
            </StackPanel>
        </Border>
        
        <!-- Loading Indicator Overlay -->
        <Grid Grid.RowSpan="3" 
              Visibility="{Binding IsLoading, Converter={StaticResource BoolToVisibilityConverter}}"
              Background="#80000000">
            <StackPanel HorizontalAlignment="Center" VerticalAlignment="Center">
                <ProgressBar IsIndeterminate="True" Width="200" Height="20"/>
                <TextBlock Text="Loading..." Foreground="White" Margin="0,10,0,0" FontSize="14"/>
            </StackPanel>
        </Grid>
        
        <!-- Error Message Display -->
        <Border Grid.RowSpan="3" 
                Visibility="{Binding ErrorMessage, Converter={StaticResource BoolToVisibilityConverter}}"
                Background="#FFEEEE" 
                BorderBrush="#FF0000" 
                BorderThickness="2"
                Padding="10"
                Margin="20"
                VerticalAlignment="Top">
            <StackPanel>
                <TextBlock Text="Error" FontWeight="Bold" Foreground="#CC0000" Margin="0,0,0,5"/>
                <TextBlock Text="{Binding ErrorMessage}" TextWrapping="Wrap" Foreground="#CC0000"/>
                <Button Content="Dismiss" Command="{Binding DismissErrorCommand}" 
                        HorizontalAlignment="Right" Margin="0,10,0,0" Padding="10,5"/>
            </StackPanel>
        </Border>
    </Grid>
</UserControl>
